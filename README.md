# Google Protobuf implementation for MicroPython 1.17+

This library in inspired by [micropython-uprotobuf](https://github.com/jazzycamel/micropython-uprotobuf) and [ExProtobuf](https://github.com/elixir-protobuf/protobuf).

The main goal is to implement [Google Protocol buffers](https://developers.google.com/protocol-buffers) for MicroPython and embedded systems.

## Main ideas

* KISS and ideomatic code base
* Embedded code (including autogenerated) should be as small and quick as possible
* Pure python code
* Should work on as much devices as possible

## Prerequisites

* python 3.9+
* micropython 1.17+ (not tested on earlier versions)
* GNU Make
* protoc 3.19+ (not tested on earlier versions)
* asdf (preferably)

## Usage

### Generating Python classes for ProtoBuf

```shell
	$ protoc --plugin=protoc-gen-custom=scripts/uprotobuf_plugin.py \
           --custom_out={OUTPUT_PATH} \
           {PATH_TO_PROTO_FILE}
```

This will generate file(s) like `{OUTPUT_PATH}/{PROTO_FILE_NAME}_upb2.py`.

### Using protobuf classes on controller

Copy your generated files and `protobuf/uprotobuf.py` to flash of your controller.
Now you can use your generated classes in your code.

Example:

animal.proto:

```protobuf
syntax = "proto2"

package animal;

message Animal {
  optional string name = 1;
}
```

To generate `animal_upb2.py` run

```shell
	$ protoc --plugin=protoc-gen-custom=scripts/uprotobuf_plugin.py \
           --custom_out=. \
           animal.proto
```

Now you can start MicroPython shell and try:
```
import animal_upb2
animal = animal_upb2.Animal()

animal.name = "Dog"

encoded_message = animal.encode() 
animal1 = Animal.decode(encoded_message)

```

## Testing

To run tests run the following command:

```shell
$ make full-tests
```

This will generate all needed classes for python3 and MicroPython, run tests on both of them and clean all generated files.
